
# Command Beautifier

`docs/00_concepts.md` で定義された Command Beautifier を実装するにあたり、新たに追加が必要なライブラリと、想定されるディレクトリ構成についてまとめる。

## 追加ライブラリ

- **`sharp`**: Node.js で動作する高パフォーマンスな画像処理ライブラリ。SVG や、アイコンなどの画像パーツを重ね合わせて動的に画像を生成する本機能の根幹を担う。
- **`react-icons`**: 豊富なアイコンが利用できるライブラリ。ゲームのボタンやアクションを示すアイコンとして利用し、これを `sharp` で画像に焼き込む。

## ディレクトリ構成案

本機能は、Next.js で構築された `apps/web` の一部として実装する。

```
apps/web
├── ... (既存のファイル)
└── src
    ├── ... (既存のファイル)
    └── app
        ├── ... (既存のファイル)
        ├── api
        │   └── trpc
        │       └── [trpc]
        │           ├── ... (既存のファイル)
        │           └── image.ts  # 画像生成API
        └── command-beautifier
            ├── page.tsx          # 画像生成フォーム
            └── components
                ├── Preview.tsx   # 生成画像のプレビュー
                └── Form.tsx      # パラメータ入力フォーム
```

### 各コンポーネントの役割

- **`image.ts`**:
  - tRPC のエンドポイントとして、画像生成リクエストを受け付ける。
  - URL パラメータからキャラクター、コマンド、スタイルなどの情報を受け取る。
  - `sharp` を用いて、受け取った情報に基づき画像を動的に生成する。
  - 生成した画像をレスポンスとして返す。
- **`page.tsx`**:
  - Command Beautifier 機能のトップページ。
  - `Preview` と `Form` コンポーネントを配置する。
- **`Preview.tsx`**:
  - `Form` で入力された内容に基づき、生成される画像のプレビューをリアルタイムに表示する。
  - 内部的には、`image.ts` と同じロジックで画像を生成するか、あるいは `image.ts` を呼び出して画像 URL を取得し、それを `<img>` タグで表示する。
- **`Form.tsx`**:
  - ユーザーがコマンドや表示スタイルなどを入力・選択するためのフォーム。
  - 入力値が変更されるたびに、`Preview` コンポーネントにその内容を通知する。
  - 最終的に、`image.ts` を呼び出すための URL を生成し、ユーザーに提供する。
