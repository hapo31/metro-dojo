# 環境変数とポート設定

このドキュメントでは、アプリケーションのフロントエンドとバックエンドのポートを環境変数で設定する方法、およびフロントエンドがバックエンドのURLを汎用的に解決する方法について説明します。

## 1. バックエンド (packages/api) のポート設定

バックエンドアプリケーションは、`PORT`環境変数からポート番号を読み込むように設定します。`PORT`環境変数が指定されていない場合は、デフォルトのポート（例: `3001`）を使用します。

**実装詳細:**
- `packages/api/index.ts` 内で、サーバーをリッスンするポートを`process.env.PORT`から取得するように変更します。

**使用例:**

開発時:
```bash
PORT=3001 pnpm run dev
```

本番環境:
環境変数はデプロイ環境に応じて設定されます。

## 2. フロントエンド (apps/web) からのバックエンドURL解決

フロントエンドは、バックエンドのURLを環境変数から取得するように設定します。Next.jsを使用しているため、`NEXT_PUBLIC_`プレフィックスを持つ環境変数はブラウザ側でも利用可能です。

**実装詳細:**
- `apps/web/src/app/_trpc/client.ts` 内で、tRPCクライアントのURLを`process.env.NEXT_PUBLIC_API_URL`から取得するように変更します。
- `NEXT_PUBLIC_API_URL`が設定されていない場合は、開発環境用のデフォルトURL（例: `http://localhost:3001`）を使用します。

**使用例:**

開発時:
```bash
# デフォルトのバックエンドURLを使用する場合
pnpm run dev

# 特定のバックエンドURLを指定する場合
NEXT_PUBLIC_API_URL=http://localhost:3001 pnpm run dev
```

本番環境:
デプロイ時に`NEXT_PUBLIC_API_URL`環境変数を設定します。例えば、VercelやDockerなどの環境で設定を行います。

例:
```bash
# Vercelの場合 (環境変数設定)
NEXT_PUBLIC_API_URL=https://your-api-domain.com
```

## 3. 全体のワークフロー

1. **バックエンドの起動**: `PORT`環境変数を指定してバックエンドを起動します。
2. **フロントエンドの起動**: `NEXT_PUBLIC_API_URL`環境変数を指定してフロントエンドを起動します。このURLは、バックエンドがリッスンしているURLとポートに対応している必要があります。
3. **本番デプロイ**: CI/CDパイプラインやデプロイサービスで、これらの環境変数を適切に設定します。

このアプローチにより、開発環境と本番環境で柔軟にポートとURLを設定できるようになります。
